!function(e,t){var s={};t.extend(s,{el:{},post_code_req_url:"http://services.postcodeanywhere.co.uk/CapturePlus/Interactive/Find/v2.10/json3.ws?callback=?",address_req_url:"http://services.postcodeanywhere.co.uk/CapturePlus/Interactive/Retrieve/v2.10/json3.ws?callback=?",response_item_id:null,api_key:null,SearchTerm:"",SearchFor:"PostalCodes",Country:"GBR",LanguagePreference:"EN",input:e(document.createElement("input")),input_class:"",input_label:"",button:e(document.createElement("a")),button_class:"",button_label:"",dropdown:e(document.createElement("select")),dropdown_class:"",dropdown_items:[],error:"",error_container:e(document.createElement("div")),address_resp:{Id:"",DomesticId:"",Language:"",LanguageAlternatives:"",Department:"",Company:"",SubBuilding:"",BuildingNumber:"",BuildingName:"",SecondaryStreet:"",Street:"",Block:"",Neighbourhood:"",District:"",City:"",Line1:"",Line2:"",Line3:"",Line4:"",Line5:"",AdminAreaName:"",AdminAreaCode:"",Province:"",ProvinceName:"",ProvinceCode:"",PostalCode:"",CountryName:"",CountryIso2:"",CountryIso3:"",CountryIsoNumber:"",SortingNumber1:"",SortingNumber2:"",Barcode:"",POBoxNumber:"",Label:"",Type:"",DataLevel:"",output_fields:null},init:function(e,s){return this.el=e,t.extend(this,s),this.checkOption()?(this.initElemsListeners(),this.initSearchElems(),this.el):void 0},checkOption:function(){return!this.el instanceof jQuery?(console.error("PostCodesAnywhere:error: this is not a jquery object"),!1):this.el.length?!0:(console.error("PostCodesAnywhere:error: can't find '"+this.el.selector+"' element in DOM"),!1)},initSearchElems:function(){return this.input.attr({type:"text",name:"post_code_finder","class":this.input_class,value:"",placeholder:this.input_label}),this.button.attr({href:"javascript:void(0);","class":"idpc_button "+this.button_class}).html(this.button_label),this.dropdown.attr({style:"display:none","class":"idpc_dropdown "+this.dropdown_class}),this.error_container.attr({style:"display:none","class":"idpc_error_message"}),this.el.append(this.input),this.el.append(this.button),this.el.append(this.dropdown),this.el.append(this.error_container),this},initElemsListeners:function(){return this.input.on("input",t.bind(this.setPostCode,this)),this.input.on("change",t.bind(this.setPostCode,this)),this.button.on("click",t.bind(this.makeRequestWithPostcode,this)),this.dropdown.on("change",t.bind(this.makeRequestByPostcodeId,this)),this},setPostCode:function(){return this.hideErrors(),this.SearchTerm=this.input.val().toLowerCase(),this},makeRequestWithPostcode:function(){if(this.SearchTerm.length){var s={Key:this.api_key,SearchTerm:this.SearchTerm,SearchFor:this.SearchFor,Country:this.Country,LanguagePreference:this.LanguagePreference};e.getJSON(this.post_code_req_url,s,t.bind(this.postcodeResponseProcessor,this))}},postcodeResponseProcessor:function(e){this.checkPostCodeRespData(e.Items)&&this.displayError(),this.initSelect(e.Items)},initSelect:function(e){this.dropdown_items=e;var t=this.createOption();this.dropdown.append(t).show()},createOption:function(){var e="";return t.each(this.dropdown_items,function(t){e+='<option value="'+t.Id+'">'+t.Text+"</option>"}),e},checkPostCodeRespData:function(e){return e.length?!1:(this.setError("We can't find addresses by this post code!"),!0)},makeRequestByPostcodeId:function(){if(this.dropdown.val()){var s={Key:this.api_key,Id:this.dropdown.val()};e.getJSON(this.address_req_url,s,t.bind(this.addressResponseProcessor,this))}},addressResponseProcessor:function(t){this.checkAddressRespData(t.Items)&&this.displayError(),this.address_resp=e.extend(!0,this.address_resp,t.Items.pop()),this.setDataToOutput(),this.onGetAddress.call(this,this.address_resp)},setDataToOutput:function(){return!this.output_fields instanceof Object?void 0:(t.each(this.output_fields,t.bind(function(t,s){var r=e(t);r.length&&r.val(this.address_resp[s])},this)),this)},onGetAddress:e.extend({callback:function(){}},arguments[0]||{}),checkAddressRespData:function(e){return e.length?!1:(this.setError("We can't find address details!"),!0)},setError:function(e){return this.error=e,this},clearError:function(){return this.error="",this},displayError:function(){return this.error_container.html(this.error).show(),this},hideErrors:function(){return this.error_container.html("").hide(),this.clearError()}}),e.fn.postcodes=function(e){return s.init(this,e)}}(jQuery,_);
